<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrammarFlow Mastery Engine</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- DESIGN BRIEF VARIABLES --- */
        :root {
            --primary-300: #F9C97A; --primary-500: #F4A329; --primary-700: #B45309;
            --secondary-300: #7EDAD6; --secondary-500: #2BB6B4; --secondary-700: #0F766E;
            --accent-300: #F49DB8; --accent-500: #E8467B;
            --bg: #FFF7F2; --surface: #FFFFFF; --surface-alt: #F5F7FA; --border: #E6E9EF;
            --text: #1F2937; --text-muted: #6B7280; --text-inverse: #FFFFFF;
            --success: #2F9E44; --error: #D92D20;
            --radius: 16px; --radius-pill: 9999px;
            --shadow: 0 4px 14px rgba(17,24,39,0.08);
            --transition: 180ms ease;
        }

        /* --- BASE STYLES --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: "Inter", "Nunito", sans-serif; background-color: var(--bg); color: var(--text); padding-top: 100px; font-size: 16px; }

        nav {
            position: fixed; top: 0; left: 0; right: 0; height: 75px; background: var(--surface);
            border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; z-index: 1000; box-shadow: var(--shadow);
        }
        .nav-logo { font-weight: 800; color: var(--secondary-700); font-size: 24px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        
        .container { width: 95%; max-width: 850px; margin: 0 auto; }
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); }

        /* Practice Config Grid */
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 24px 0; }
        .config-option { border: 2px solid var(--border); padding: 15px; border-radius: 12px; cursor: pointer; transition: var(--transition); }
        .config-option.active { border-color: var(--secondary-500); background: #f0fdfa; }

        /* Drag & Drop Styles */
        .drop-zone { min-height: 60px; border: 2px dashed var(--secondary-300); border-radius: 12px; padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; background: var(--surface-alt); }
        .word-pill { background: var(--surface); border: 1px solid var(--border); padding: 8px 16px; border-radius: var(--radius-pill); cursor: pointer; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .word-pill:hover { background: var(--secondary-500); color: white; border-color: var(--secondary-700); }

        /* Buttons - Softened as per request */
        button { cursor: pointer; font-weight: 600; border-radius: var(--radius-pill); border: none; padding: 14px 28px; transition: var(--transition); font-family: inherit; }
        .btn-primary { background: var(--secondary-500); color: white; } /* Changed to Teal */
        .btn-primary:hover { filter: brightness(95%); transform: translateY(-1px); }
        .btn-outline { background: transparent; border: 2px solid var(--secondary-300); color: var(--secondary-700); }
        
        .mcq-option { 
            width: 100%; background: var(--surface-alt); padding: 18px; 
            border-radius: 14px; border: 2px solid transparent; text-align: left; 
            margin-bottom: 12px; cursor: pointer; font-weight: 600; transition: var(--transition);
        }
        .mcq-option.selected { border-color: var(--secondary-500); background: #f0fdfa; }

        .hidden { display: none !important; }
        input[type="text"] { width: 100%; border: none; border-bottom: 3px solid var(--border); font-size: 22px; padding: 12px 0; background: transparent; color: var(--secondary-700); font-weight: 600; outline: none; }
        input[type="text"]:focus { border-color: var(--secondary-500); }
    </style>
</head>
<body>

    <nav>
        <div class="nav-logo" onclick="location.reload()"><i data-lucide="sparkles"></i> GrammarFlow</div>
        <div style="font-weight: 600; color: var(--text-muted)" id="global-score-display"></div>
    </nav>

    <div class="container">
        <div id="view-landing">
            <h1 style="margin-bottom: 10px;">Welcome, Educator! ðŸŽ“</h1>
            <p style="color: var(--text-muted); margin-bottom: 30px;">Select a unit to begin scaffolding your knowledge.</p>
            <div id="topic-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;"></div>
        </div>

        <div id="view-setup" class="hidden">
            <div class="card">
                <h2>Practice Configuration</h2>
                <p style="color: var(--text-muted)">Customize your session for optimal learning.</p>
                
                <div class="config-grid">
                    <div>
                        <label style="font-weight: 700; font-size: 12px; text-transform: uppercase;">Exercise Count</label>
                        <select id="setup-count" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); margin-top: 8px;">
                            <option value="5">5 Questions</option>
                            <option value="10">10 Questions</option>
                            <option value="20">All Questions</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-weight: 700; font-size: 12px; text-transform: uppercase;">Difficulty</label>
                        <div style="padding-top: 10px; display: flex; gap: 10px;">
                            <label><input type="checkbox" checked id="type-mcq"> MCQ</label>
                            <label><input type="checkbox" checked id="type-prod"> Production</label>
                        </div>
                    </div>
                </div>
                <button class="btn-primary" style="width: 100%" onclick="launchPractice()">Start Practice</button>
            </div>
        </div>

        <div id="view-login" class="hidden">
            <div class="card" style="max-width: 500px; margin: 0 auto;">
                <h2 style="margin-bottom: 20px;">Graded Session</h2>
                <input type="text" id="student-nick" placeholder="Student Name" style="margin-bottom: 20px;">
                <input type="text" id="student-class" placeholder="Class/Group" style="margin-bottom: 20px;">
                <button class="btn-primary" style="width: 100%" onclick="launchTest()">Enter Test</button>
            </div>
        </div>

        <div id="view-engine" class="hidden">
            <div class="card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: 700; font-size: 13px;">
                    <span id="mode-tag" style="color: var(--secondary-500)"></span>
                    <span id="progress-tag"></span>
                </div>
                <h2 id="question-text" style="margin-bottom: 24px;"></h2>
                <div id="interaction-area"></div>
                
                <div style="margin-top: 30px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border); padding-top: 20px;">
                    <div id="feedback-msg" style="font-weight: 700;"></div>
                    <button id="action-btn" class="btn-primary">Submit Answer</button>
                </div>
            </div>
        </div>

        <div id="view-results" class="hidden">
            <div class="card" style="text-align: center;">
                <h1 id="res-title">Excellent Work!</h1>
                <p id="res-score" style="font-size: 48px; font-weight: 800; color: var(--secondary-500); margin: 20px 0;"></p>
                <button class="btn-primary" onclick="location.reload()">Return Home</button>
            </div>
        </div>
    </div>

    <script>
        // Mock data logic for demonstration - In production, this loads from data.js
        const MOCK_DATA = [
            { type: 'mcq', q: "Which sentence is correct?", options: ["He don't like appls", "He doesn't like apples", "He not like apples"], a: "He doesn't like apples", pts: 10 },
            { type: 'prod', q: "Correct the sentence: 'She go to school every day.'", a: "She goes to school every day", pts: 10 },
            { type: 'scramble', q: "Order the words:", a: "I am learning English", words: ["learning", "I", "English", "am"], pts: 15 }
        ];

        let state = {
            mode: 'practice',
            questions: [],
            index: 0,
            score: 0,
            maxScore: 0,
            scrambleAnswer: []
        };

        function init() {
            lucide.createIcons();
            // In reality, this loop uses GRAMMAR_UNITS
            const grid = document.getElementById('topic-grid');
            const demoUnits = [{title: "Present Simple", file: "unit1.js"}];
            
            grid.innerHTML = demoUnits.map(u => `
                <div class="card" style="padding: 24px;">
                    <h3 style="margin-bottom: 15px;">${u.title}</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-outline" style="flex:1" onclick="startSetup('${u.file}')">Practice</button>
                        <button class="btn-primary" style="flex:1" onclick="prepTest('${u.file}')">Test</button>
                    </div>
                </div>
            `).join('');
        }

        function startSetup(file) {
            showView('view-setup');
        }

        function launchPractice() {
            const count = parseInt(document.getElementById('setup-count').value);
            state.mode = 'practice';
            state.questions = MOCK_DATA.slice(0, count); // Shuffled in production
            state.index = 0;
            state.score = 0;
            state.maxScore = state.questions.reduce((a, b) => a + b.pts, 0);
            showView('view-engine');
            renderQuestion();
        }

        function prepTest(file) {
            state.mode = 'test';
            showView('view-login');
        }

        function launchTest() {
            state.questions = MOCK_DATA;
            state.index = 0;
            state.score = 0;
            state.maxScore = state.questions.reduce((a, b) => a + b.pts, 0);
            showView('view-engine');
            renderQuestion();
        }

        function renderQuestion() {
            const q = state.questions[state.index];
            const area = document.getElementById('interaction-area');
            const btn = document.getElementById('action-btn');
            document.getElementById('feedback-msg').innerHTML = "";
            document.getElementById('mode-tag').innerText = state.mode.toUpperCase() + " MODE";
            document.getElementById('progress-tag').innerText = `Q ${state.index + 1} / ${state.questions.length}`;
            document.getElementById('question-text').innerText = q.q;
            
            btn.innerText = "Submit Answer";
            btn.onclick = checkAnswer;

            if (q.type === 'mcq') {
                area.innerHTML = q.options.map(o => `<div class="mcq-option" onclick="selectMCQ(this, '${o}')">${o}</div>`).join('');
                state.tempAns = null;
            } else if (q.type === 'prod') {
                area.innerHTML = `<input type="text" id="prod-input" autocomplete="off" placeholder="Type here...">`;
                document.getElementById('prod-input').focus();
            } else if (q.type === 'scramble') {
                state.scrambleAnswer = [];
                area.innerHTML = `
                    <div class="drop-zone" id="drop-zone"></div>
                    <div id="word-pool" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${q.words.map(w => `<div class="word-pill" onclick="handleScrambleClick(this, '${w}')">${w}</div>`).join('')}
                    </div>
                `;
            }
        }

        function handleScrambleClick(el, word) {
            const zone = document.getElementById('drop-zone');
            if (el.parentNode.id === 'word-pool') {
                zone.appendChild(el);
                state.scrambleAnswer.push(word);
            } else {
                document.getElementById('word-pool').appendChild(el);
                state.scrambleAnswer = state.scrambleAnswer.filter(w => w !== word);
            }
        }

        function selectMCQ(el, val) {
            document.querySelectorAll('.mcq-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            state.tempAns = val;
        }

        function checkAnswer() {
            const q = state.questions[state.index];
            let userAns = "";

            if (q.type === 'mcq') userAns = state.tempAns;
            else if (q.type === 'prod') userAns = document.getElementById('prod-input').value;
            else if (q.type === 'scramble') userAns = state.scrambleAnswer.join(" ");

            if (!userAns && q.type !== 'scramble') return;

            const isCorrect = userAns.toLowerCase().trim() === q.a.toLowerCase().trim();
            if (isCorrect) state.score += q.pts;

            if (state.mode === 'practice') {
                const feedback = document.getElementById('feedback-msg');
                feedback.innerHTML = isCorrect ? `<span style="color:var(--success)">Correct! +${q.pts}</span>` : `<span style="color:var(--error)">Incorrect. Answer: ${q.a}</span>`;
                document.getElementById('action-btn').innerText = "Continue";
                document.getElementById('action-btn').onclick = () => { state.index++; moveNext(); };
                updateHeaderScore();
            } else {
                state.index++;
                moveNext();
            }
        }

        function moveNext() {
            if (state.index < state.questions.length) renderQuestion();
            else finish();
        }

        function updateHeaderScore() {
            document.getElementById('global-score-display').innerText = `Current Score: ${state.score}`;
        }

        function finish() {
            showView('view-results');
            document.getElementById('res-score').innerText = `${state.score} / ${state.maxScore}`;
        }

        function showView(id) {
            ['view-landing', 'view-setup', 'view-login', 'view-engine', 'view-results'].forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
